stages:
  - Build_2M
  - Build_512K
  - Build_1M
  - cppcheck
  - tests
  - deploy

variables:
    GIT_CLEAN_FLAGS: -ffdx -e boot/cypress/libs -e venv
    GIT_SUBMODULE_STRATEGY: recursive

    CY_BOOTLOADER_MAJOR: 1
    CY_BOOTLOADER_MINOR: 1
    CY_BOOTLOADER_REV: 0
    CY_BOOTLOADER_BUILD: $CI_PIPELINE_IID
    
    CY_SECURETOOLS_BRANCH: develop
    PYOCD_BRANCH: smif-support
    
    
##############################################################################
# Build 
#

.build_1M:
  stage: Build_1M
  dependencies: []
  artifacts:
    expire_in: 4 weeks
    paths:
      - deploy
      - develop
      
.build_512K:
  stage: Build_512K
  dependencies: []
  artifacts:
    expire_in: 4 weeks
    paths:
      - deploy
      - develop

.build_2M:
  stage: Build_2M
  dependencies: []
  artifacts:
    expire_in: 4 weeks
    paths:
      - deploy
      - develop

mac_1M_Bootloader:
  extends: .build_1M
  tags:
    - FWS_MAC_BUILD
  script:
    # Build Release
    - >
      ./ci/build/build.sh
      APP_NAME=CypressBootloader
      PLATFORM=PSOC_064_1M
      BUILDCFG=Release
      MAKEINFO=0
      POST_BUILD=1
    # (TO DO: "Result image does not fit into bootloader region") Build Debug 
    - >
      ./ci/build/build.sh
      APP_NAME=CypressBootloader
      PLATFORM=PSOC_064_1M
      BUILDCFG=Debug
      MAKEINFO=0
      POST_BUILD=1 

mac_1M_BlinkyApp:
  extends: .build_1M
  tags:
    - FWS_MAC_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_1M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_1M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_1M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_1M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug        

mac_1M_Multi_BlinkyApp:
  extends: .build_1M
  tags:
    - FWS_MAC_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_1M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_1M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_1M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_1M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug       

mac_1M_SecureBlinkyApp:
  extends: .build_1M
  tags:
    - FWS_MAC_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_1M
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_1M
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_1M
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_1M
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug

.mac_1M_BlinkyApp_smif:
  extends: .build_1M
  tags:
    - FWS_MAC_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=_smif
      PLATFORM=PSOC_064_1M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=_smif
      PLATFORM=PSOC_064_1M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=_smif
      PLATFORM=PSOC_064_1M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=_smif
      PLATFORM=PSOC_064_1M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug        

.mac_1M_Multi_BlinkyApp_smif:
  extends: .build_1M
  tags:
    - FWS_MAC_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=Multi_smif
      PLATFORM=PSOC_064_1M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=Multi_smif
      PLATFORM=PSOC_064_1M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=Multi_smif
      PLATFORM=PSOC_064_1M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=Multi_smif
      PLATFORM=PSOC_064_1M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug       

.mac_1M_SecureBlinkyApp_smif:
  extends: .build_1M
  tags:
    - FWS_MAC_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=_smif
      PLATFORM=PSOC_064_1M
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=_smif
      PLATFORM=PSOC_064_1M
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=_smif
      PLATFORM=PSOC_064_1M
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=_smif
      PLATFORM=PSOC_064_1M
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug
  


mac_512K_Bootloader:
  extends: .build_512K
  tags:
    - FWS_MAC_BUILD
  script:
    # Build Release
    - >
      ./ci/build/build.sh
      APP_NAME=CypressBootloader
      PLATFORM=PSOC_064_512K
      BUILDCFG=Release
      MAKEINFO=0
      POST_BUILD=1
# (TO DO: "Result image does not fit into bootloader region") Build Debug 
    - >
      ./ci/build/build.sh
      APP_NAME=CypressBootloader
      PLATFORM=PSOC_064_512K
      BUILDCFG=Debug
      MAKEINFO=0
      POST_BUILD=1

mac_512K_BlinkyApp:
  extends: .build_512K
  tags:
    - FWS_MAC_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug

mac_512K_Multi_BlinkyApp:
  extends: .build_512K
  tags:
    - FWS_MAC_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug

mac_512K_SecureBlinkyApp:
  extends: .build_512K
  tags:
    - FWS_MAC_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_512K
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_512K
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_512K
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_512K
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug

mac_512K_BlinkyApp_smif:
  extends: .build_512K
  tags:
    - FWS_MAC_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=_smif
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=_smif
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=_smif
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=_smif
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug        

mac_512K_Multi_BlinkyApp_smif:
  extends: .build_512K
  tags:
    - FWS_MAC_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=Multi_smif
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=Multi_smif
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=Multi_smif
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=Multi_smif
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug       

mac_512K_SecureBlinkyApp_smif:
  extends: .build_512K
  tags:
    - FWS_MAC_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=_smif
      PLATFORM=PSOC_064_512K
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=_smif
      PLATFORM=PSOC_064_512K
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=_smif
      PLATFORM=PSOC_064_512K
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=_smif
      PLATFORM=PSOC_064_512K
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug



     
.win_512K_Bootloader:
  extends: .build_512K
  tags:
    - FWS_WIN_BUILD
  script:
    - $env:Path="c:\cygwin64;c:\cygwin64\bin;$env:Path"
    # Build Release
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=CypressBootloader
      PLATFORM=PSOC_064_512K
      BUILDCFG=Release
      MAKEINFO=0
      POST_BUILD=1
    # Build Debug
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=CypressBootloader
      PLATFORM=PSOC_064_512K
      BUILDCFG=Debug
      MAKEINFO=0
      POST_BUILD=1

.win_512K_BlinkyApp:
  extends: .build_512K
  tags:
    - FWS_WIN_BUILD
  script:
    - $env:Path="c:\cygwin64;c:\cygwin64\bin;$env:Path"
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug

.win_512K_Multi_BlinkyApp:
  extends: .build_512K
  tags:
    - FWS_WIN_BUILD
  script:
    - $env:Path="c:\cygwin64;c:\cygwin64\bin;$env:Path"
    # BOOT
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug

.win_512K_SecureBlinkyApp:
  extends: .build_512K
  tags:
    - FWS_WIN_BUILD
  script:
    - $env:Path="c:\cygwin64;c:\cygwin64\bin;$env:Path"
    # BOOT
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_512K
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_512K
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_512K
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_512K
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug      

lin_1M_Bootloader:
  extends: .build_1M
  tags:
    - FWS_LIN_BUILD
  script:
    # Build Release
    - >
      ./ci/build/build.sh
      APP_NAME=CypressBootloader
      PLATFORM=PSOC_064_1M
      BUILDCFG=Release
      MAKEINFO=0
      POST_BUILD=1
    # (TO DO: "Result image does not fit into bootloader region") Build Debug 
    # - >
      # ./ci/build/build.sh
      # APP_NAME=CypressBootloader
      # PLATFORM=PSOC_064_1M
      # BUILDCFG=Debug
      # MAKEINFO=0
      # POST_BUILD=1

lin_1M_BlinkyApp:
  extends: .build_1M
  tags:
    - FWS_LIN_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_1M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_1M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_1M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_1M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug        

lin_1M_Multi_BlinkyApp:
  extends: .build_1M
  tags:
    - FWS_LIN_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_1M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_1M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_1M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_1M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug       

lin_1M_SecureBlinkyApp:
  extends: .build_1M
  tags:
    - FWS_LIN_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_1M
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_1M
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_1M
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_1M
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug

lin_512K_Bootloader:
  extends: .build_512K
  tags:
    - FWS_LIN_BUILD
  script:
    # Build Release
    - >
      ./ci/build/build.sh
      APP_NAME=CypressBootloader
      PLATFORM=PSOC_064_512K
      BUILDCFG=Release
      MAKEINFO=0
      POST_BUILD=1
    #(TO DO: "Result image does not fit into bootloader region") Build Debug 
    # - >
      # ./ci/build/build.sh
      # APP_NAME=CypressBootloader
      # PLATFORM=PSOC_064_512K
      # BUILDCFG=Debug
      # MAKEINFO=0
      # POST_BUILD=1

lin_512K_BlinkyApp:
  extends: .build_512K
  tags:
    - FWS_LIN_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug

lin_512K_Multi_BlinkyApp:
  extends: .build_512K
  tags:
    - FWS_LIN_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_512K
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug

lin_512K_SecureBlinkyApp:
  extends: .build_512K
  tags:
    - FWS_LIN_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_512K
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_512K
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_512K
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_512K
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug

mac_2M_Bootloader:
  extends: .build_2M
  tags:
    - FWS_MAC_BUILD
  script:
    # Build Release
    - >
      ./ci/build/build.sh
      APP_NAME=CypressBootloader
      PLATFORM=PSOC_064_2M
      BUILDCFG=Release
      MAKEINFO=0
      POST_BUILD=1
    #(TO DO: "Result image does not fit into bootloader region") Build Debug 
    - >
      ./ci/build/build.sh
      APP_NAME=CypressBootloader
      PLATFORM=PSOC_064_2M
      BUILDCFG=Debug
      MAKEINFO=0
      POST_BUILD=1

mac_2M_BlinkyApp:
  extends: .build_2M
  tags:
    - FWS_MAC_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug

mac_2M_Multi_BlinkyApp:
  extends: .build_2M
  tags:
    - FWS_MAC_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug

mac_2M_SecureBlinkyApp:
  extends: .build_2M
  tags:
    - FWS_MAC_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_2M
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_2M
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_2M
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_2M
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug

mac_2M_BlinkyApp_smif:
  extends: .build_2M
  tags:
    - FWS_MAC_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=_smif
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=_smif
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=_smif
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=_smif
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug        

mac_2M_Multi_BlinkyApp_smif:
  extends: .build_2M
  tags:
    - FWS_MAC_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=Multi_smif
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=Multi_smif
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=Multi_smif
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=Multi_smif
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug       

mac_2M_SecureBlinkyApp_smif:
  extends: .build_2M
  tags:
    - FWS_MAC_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=_smif
      PLATFORM=PSOC_064_2M
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=_smif
      PLATFORM=PSOC_064_2M
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=_smif
      PLATFORM=PSOC_064_2M
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      SMIF_UPGRADE=1
      APP_SUFX=_smif
      PLATFORM=PSOC_064_2M
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug

.win_2M_Bootloader:
  extends: .build_2M
  tags:
    - FWS_WIN_BUILD
  script:
    - $env:Path="c:\cygwin64;c:\cygwin64\bin;$env:Path"
    # Build Release
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=CypressBootloader
      PLATFORM=PSOC_064_2M
      BUILDCFG=Release
      MAKEINFO=0
      POST_BUILD=1
    # Build Debug
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=CypressBootloader
      PLATFORM=PSOC_064_2M
      BUILDCFG=Debug
      MAKEINFO=0
      POST_BUILD=1

.win_2M_BlinkyApp:
  extends: .build_2M
  tags:
    - FWS_WIN_BUILD
  script:
    - $env:Path="c:\cygwin64;c:\cygwin64\bin;$env:Path"
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug

.win_2M_Multi_BlinkyApp:
  extends: .build_2M
  tags:
    - FWS_WIN_BUILD
  script:
    - $env:Path="c:\cygwin64;c:\cygwin64\bin;$env:Path"
    # BOOT
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug

.win_2M_SecureBlinkyApp:
  extends: .build_2M
  tags:
    - FWS_WIN_BUILD
  script:
    - $env:Path="c:\cygwin64;c:\cygwin64\bin;$env:Path"
    # BOOT
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_2M
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_2M
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_2M
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      & "bash" "./ci/build/build.sh"
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_2M
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug

lin_2M_Bootloader:
  extends: .build_2M
  tags:
    - FWS_LIN_BUILD
  script:
    # Build Release
    - >
      ./ci/build/build.sh
      APP_NAME=CypressBootloader
      PLATFORM=PSOC_064_2M
      BUILDCFG=Release
      MAKEINFO=0
      POST_BUILD=1
    #(TO DO: "Result image does not fit into bootloader region") Build Debug 
    # - >
      # ./ci/build/build.sh
      # APP_NAME=CypressBootloader
      # PLATFORM=PSOC_064_2M
      # BUILDCFG=Debug
      # MAKEINFO=0
      # POST_BUILD=1

lin_2M_BlinkyApp:
  extends: .build_2M
  tags:
    - FWS_LIN_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=0
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug

lin_2M_Multi_BlinkyApp:
  extends: .build_2M
  tags:
    - FWS_LIN_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=BlinkyApp
      APP_SUFX=Multi
      PLATFORM=PSOC_064_2M
      MULTI_IMAGE=1
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug

lin_2M_SecureBlinkyApp:
  extends: .build_2M
  tags:
    - FWS_LIN_BUILD
  script:
    # BOOT
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_2M
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_2M
      MAKEINFO=0
      IMG_TYPE=BOOT
      BUILDCFG=Debug
    # UPGRADE
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_2M
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Release
    - >
      ci/build/build.sh
      APP_NAME=SecureBlinkyApp
      PLATFORM=PSOC_064_2M
      MAKEINFO=0
      IMG_TYPE=UPGRADE
      BUILDCFG=Debug



##############################################################################
# Run Test 
#


#######################################################################################################################################################
##################------------------------------------------------- TESTS 512K -------------------------------------------#############################
#######################################################################################################################################################

mac_test_512K_Release:
  stage: tests
  tags:
    - MBED_TEST_MAC1014
  variables:
    GIT_SUBMODULE_STRATEGY: none    
  needs:
    - mac_512K_Bootloader
    - mac_512K_Multi_BlinkyApp
    - mac_512K_SecureBlinkyApp
    - mac_512K_BlinkyApp
  only:
    variables:
      - $SCHEDULE == "true"
  script:
    - export https_proxy=http://proxy.ua.cypress.com:8080
    - python3 --version
    - virtualenv venv
    - source venv/bin/activate
    - python3 -m pip install pyserial
    - python3 -m pip install --upgrade --force-reinstall git+http://git-ore.aus.cypress.com/repo/cysecuretools.git@${CY_SECURETOOLS_BRANCH}
    - python3 -m pip install --upgrade --force-reinstall git+http://git-ore.aus.cypress.com/repo/pyocd.git@${PYOCD_BRANCH}
    - pwd
    - rm -rf ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx5/prebuilt/CyBootloader_Release
    - rm ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx5/prebuilt/CyBootloader_WithLogs/CypressBootloader_CM0p.jwt
    - rm ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx5/prebuilt/CyBootloader_WithLogs/CypressBootloader_CM0p.hex
    - cp -r ./develop/PSOC_064_512K/CypressBootloader/Release/*.hex ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx5/prebuilt/CyBootloader_WithLogs/
    - cp -r ./develop/PSOC_064_512K/CypressBootloader/Release/*.jwt ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx5/prebuilt/CyBootloader_WithLogs/



    - '[ -d tests ] && echo "[INFO] Directory tests exists." || echo "[INFO] Directory tests does not exists." && git clone http://git-ore.aus.cypress.com/repo/cy_mcuboot_project/cy_mcuboot.git tests && cd tests && git checkout tests_kosx_es100 && git branch && cd .. '
    - cd tests
    - mbedls -j > mbedls_data.json
    - pwd
    - echo "[INFO] Test provisioning using single stage policy (CM4), CyBootloader WithLogs"
    - python3 -m unittest test_provisioning.TestProvisioning.test_provision_512k_release_single_image
    - cd ..
    - rm -rf tests
    
    

    - '[ -d tests ] && echo "[INFO] Directory tests exists." || echo "[INFO] Directory tests does not exists." && git clone http://git-ore.aus.cypress.com/repo/cy_mcuboot_project/cy_mcuboot.git tests && cd tests && git checkout tests_kosx_es100 && git branch && cd .. '
    - cd tests
    - mbedls -j > mbedls_data.json
    - pwd
    - echo "[INFO] Test provisioning multi image, CyBootloader WithLogs"
    - python3 -m unittest test_provisioning.TestProvisioning.test_provision_512k_release_multi_image
    - cd ..
    - rm -rf tests



    - deactivate

  artifacts:
    expire_in: 4 weeks
    paths:
      - deploy


mac_test_512K_Debug:
  stage: tests
  tags:
    - MBED_TEST_MAC1014
  variables:
    GIT_SUBMODULE_STRATEGY: none    
  needs:
    - mac_512K_Bootloader
    - mac_512K_Multi_BlinkyApp
    - mac_512K_SecureBlinkyApp
    - mac_512K_BlinkyApp
  script:
    - export https_proxy=http://proxy.ua.cypress.com:8080
    - python3 --version
    - virtualenv venv
    - source venv/bin/activate
    - python3 -m pip install pyserial
    - python3 -m pip install --upgrade --force-reinstall git+http://git-ore.aus.cypress.com/repo/cysecuretools.git@${CY_SECURETOOLS_BRANCH}
    - python3 -m pip install --upgrade --force-reinstall git+http://git-ore.aus.cypress.com/repo/pyocd.git@${PYOCD_BRANCH}
    - pwd
    - rm -rf ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx5/prebuilt/CyBootloader_Release
    - rm ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx5/prebuilt/CyBootloader_WithLogs/CypressBootloader_CM0p.jwt
    - rm ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx5/prebuilt/CyBootloader_WithLogs/CypressBootloader_CM0p.hex
    - cp -r ./develop/PSOC_064_512K/CypressBootloader/Debug/*.hex ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx5/prebuilt/CyBootloader_WithLogs/
    - cp -r ./develop/PSOC_064_512K/CypressBootloader/Debug/*.jwt ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx5/prebuilt/CyBootloader_WithLogs/



    - '[ -d tests ] && echo "[INFO] Directory tests exists." || echo "[INFO] Directory tests does not exists." && git clone http://git-ore.aus.cypress.com/repo/cy_mcuboot_project/cy_mcuboot.git tests && cd tests && git checkout tests_kosx_es100 && git branch && cd .. '
    - cd tests
    - mbedls -j > mbedls_data.json
    - pwd
    - echo "[INFO] Test provisioning using single stage policy (CM4), CyBootloader WithLogs"
    - python3 -m unittest test_provisioning.TestProvisioning.test_provision_512k_release_single_image
    - cd ..
    - rm -rf tests
    
    

    - '[ -d tests ] && echo "[INFO] Directory tests exists." || echo "[INFO] Directory tests does not exists." && git clone http://git-ore.aus.cypress.com/repo/cy_mcuboot_project/cy_mcuboot.git tests && cd tests && git checkout tests_kosx_es100 && git branch && cd .. '
    - cd tests
    - mbedls -j > mbedls_data.json
    - pwd
    - echo "[INFO] Test provisioning multi image, CyBootloader WithLogs"
    - python3 -m unittest test_provisioning.TestProvisioning.test_provision_512k_release_multi_image
    - cd ..
    - rm -rf tests



    - deactivate

  artifacts:
    expire_in: 4 weeks
    paths:
      - deploy


mac_test_512K_smif_Release:
  stage: tests
  tags:
    - MBED_TEST_MAC1014
  variables:
    GIT_SUBMODULE_STRATEGY: none    
  needs:
    - mac_512K_Bootloader
    - mac_512K_Multi_BlinkyApp_smif
    - mac_512K_SecureBlinkyApp_smif
    - mac_512K_BlinkyApp_smif
  only:
    variables:
      - $SCHEDULE == "true"
  script:
    - export https_proxy=http://proxy.ua.cypress.com:8080
    - python3 --version
    - virtualenv venv
    - source venv/bin/activate
    - python3 -m pip install pyserial
    - python3 -m pip install --upgrade --force-reinstall git+http://git-ore.aus.cypress.com/repo/cysecuretools.git@${CY_SECURETOOLS_BRANCH}
    - python3 -m pip install --upgrade --force-reinstall git+http://git-ore.aus.cypress.com/repo/pyocd.git@${PYOCD_BRANCH}
    - pwd
    - rm -rf ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx5/prebuilt/CyBootloader_Release
    - rm ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx5/prebuilt/CyBootloader_WithLogs/CypressBootloader_CM0p.jwt
    - rm ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx5/prebuilt/CyBootloader_WithLogs/CypressBootloader_CM0p.hex
    - cp -r ./develop/PSOC_064_512K/CypressBootloader/Release/*.hex ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx5/prebuilt/CyBootloader_WithLogs/
    - cp -r ./develop/PSOC_064_512K/CypressBootloader/Release/*.jwt ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx5/prebuilt/CyBootloader_WithLogs/



    - echo "[INFO] Start tests"
    - '[ -d tests ] && echo "[INFO] Directory tests exists." || echo "[INFO] Directory tests does not exists." && git clone http://git-ore.aus.cypress.com/repo/cy_mcuboot_project/cy_mcuboot.git tests && cd tests && git checkout tests_kosx_es100 && git branch && cd .. '
    - cd tests
    - mbedls -j > mbedls_data.json
    - pwd
    - echo "[INFO] Test provisioning using single stage policy (CM4), CyBootloader WithLogs"
    - python3 -m unittest test_provisioning.TestProvisioning.test_provision_512k_release_single_image_smif
    - cd ..
    - rm -rf tests    

    

    - '[ -d tests ] && echo "[INFO] Directory tests exists." || echo "[INFO] Directory tests does not exists." && git clone http://git-ore.aus.cypress.com/repo/cy_mcuboot_project/cy_mcuboot.git tests && cd tests && git checkout tests_kosx_es100 && git branch && cd .. '
    - cd tests
    - mbedls -j > mbedls_data.json
    - pwd
    - echo "[INFO] Test provisioning using single stage policy (CM4), CyBootloader WithLogs"
    - python3 -m unittest test_provisioning.TestProvisioning.test_provision_512k_release_multi_image_smif
    - cd ..
    - rm -rf tests
    


    - deactivate

  artifacts:
    expire_in: 4 weeks
    paths:
      - deploy




mac_test_512K_smif_Debug:
  stage: tests
  tags:
    - MBED_TEST_MAC1014
  variables:
    GIT_SUBMODULE_STRATEGY: none    
  needs:
    - mac_512K_Bootloader
    - mac_512K_Multi_BlinkyApp_smif
    - mac_512K_SecureBlinkyApp_smif
    - mac_512K_BlinkyApp_smif
  script:
    - export https_proxy=http://proxy.ua.cypress.com:8080
    - python3 --version
    - virtualenv venv
    - source venv/bin/activate
    - python3 -m pip install pyserial
    - python3 -m pip install --upgrade --force-reinstall git+http://git-ore.aus.cypress.com/repo/cysecuretools.git@${CY_SECURETOOLS_BRANCH}
    - python3 -m pip install --upgrade --force-reinstall git+http://git-ore.aus.cypress.com/repo/pyocd.git@${PYOCD_BRANCH}
    - pwd
    - rm -rf ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx5/prebuilt/CyBootloader_Release
    - rm ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx5/prebuilt/CyBootloader_WithLogs/CypressBootloader_CM0p.jwt
    - rm ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx5/prebuilt/CyBootloader_WithLogs/CypressBootloader_CM0p.hex
    - cp -r ./develop/PSOC_064_512K/CypressBootloader/Debug/*.hex ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx5/prebuilt/CyBootloader_WithLogs/
    - cp -r ./develop/PSOC_064_512K/CypressBootloader/Debug/*.jwt ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx5/prebuilt/CyBootloader_WithLogs/



    - echo "[INFO] Start tests"
    - '[ -d tests ] && echo "[INFO] Directory tests exists." || echo "[INFO] Directory tests does not exists." && git clone http://git-ore.aus.cypress.com/repo/cy_mcuboot_project/cy_mcuboot.git tests && cd tests && git checkout tests_kosx_es100 && git branch && cd .. '
    - cd tests
    - mbedls -j > mbedls_data.json
    - pwd
    - echo "[INFO] Test provisioning using single stage policy (CM4), CyBootloader WithLogs"
    - python3 -m unittest test_provisioning.TestProvisioning.test_provision_512k_release_single_image_smif
    - cd ..
    - rm -rf tests    

    

    - '[ -d tests ] && echo "[INFO] Directory tests exists." || echo "[INFO] Directory tests does not exists." && git clone http://git-ore.aus.cypress.com/repo/cy_mcuboot_project/cy_mcuboot.git tests && cd tests && git checkout tests_kosx_es100 && git branch && cd .. '
    - cd tests
    - mbedls -j > mbedls_data.json
    - pwd
    - echo "[INFO] Test provisioning using single stage policy (CM4), CyBootloader WithLogs"
    - python3 -m unittest test_provisioning.TestProvisioning.test_provision_512k_release_multi_image_smif
    - cd ..
    - rm -rf tests
    


    - deactivate

  artifacts:
    expire_in: 4 weeks
    paths:
      - deploy



#######################################################################################################################################################
##################------------------------------------------------- TESTS 2M ---------------------------------------------#############################
#######################################################################################################################################################

.mac_test_2M_Release:
  stage: tests
  variables:
    GIT_SUBMODULE_STRATEGY: none
  tags:
    - MBED_TEST_MAC1014
  needs:
    - mac_2M_Bootloader
    - mac_2M_Multi_BlinkyApp
    - mac_2M_SecureBlinkyApp
    - mac_2M_BlinkyApp
  only:
    variables:
      - $SCHEDULE == "true"
  script:
    - export https_proxy=http://proxy.ua.cypress.com:8080
    - python3 --version
    - virtualenv venv
    - source venv/bin/activate
    - python3 -m pip install pyserial
    - python3 -m pip install --upgrade --force-reinstall git+http://git-ore.aus.cypress.com/repo/cysecuretools.git@${CY_SECURETOOLS_BRANCH}
    - python3 -m pip install --upgrade --force-reinstall git+http://git-ore.aus.cypress.com/repo/pyocd.git@${PYOCD_BRANCH}
    - pwd
    - rm -rf ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xxa/prebuilt/CyBootloader_Release
    - rm ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xxa/prebuilt/CyBootloader_WithLogs/CypressBootloader_CM0p.jwt
    - rm ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xxa/prebuilt/CyBootloader_WithLogs/CypressBootloader_CM0p.hex
    - cp -r ./develop/PSOC_064_2M/CypressBootloader/Release/*.hex ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xxa/prebuilt/CyBootloader_WithLogs/
    - cp -r ./develop/PSOC_064_2M/CypressBootloader/Release/*.jwt ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xxa/prebuilt/CyBootloader_WithLogs/

    - echo "[INFO] Start tests"


    - '[ -d tests ] && echo "[INFO] Directory tests exists." || echo "[INFO] Directory tests does not exists." && git clone http://git-ore.aus.cypress.com/repo/cy_mcuboot_project/cy_mcuboot.git tests && cd tests && git checkout tests_kosx_es100 && git branch && cd .. '
    - cd tests
    - mbedls -j > mbedls_data.json
    - pwd
    - echo "[INFO] Test provisioning using single stage policy (CM4), CyBootloader WithLogs"
    - python3 -m unittest test_provisioning.TestProvisioning.test_provision_2M_release_single_image
    - cd ..
    - rm -rf tests



    - '[ -d tests ] && echo "[INFO] Directory tests exists." || echo "[INFO] Directory tests does not exists." && git clone http://git-ore.aus.cypress.com/repo/cy_mcuboot_project/cy_mcuboot.git tests && cd tests && git checkout tests_kosx_es100 && git branch && cd .. '
    - cd tests
    - mbedls -j > mbedls_data.json
    - pwd
    - echo "[INFO] Test provisioning multi image, CyBootloader WithLogs"
    - python3 -m unittest test_provisioning.TestProvisioning.test_provision_2M_release_multi_image
    - cd ..
    - rm -rf tests



    - deactivate

  artifacts:
    expire_in: 4 weeks
    paths:
      - deploy



.mac_test_2M_Debug:
  stage: tests
  variables:
    GIT_SUBMODULE_STRATEGY: none
  tags:
    - MBED_TEST_MAC1014
  needs:
    - mac_2M_Bootloader
    - mac_2M_Multi_BlinkyApp
    - mac_2M_SecureBlinkyApp
    - mac_2M_BlinkyApp
  script:
    - export https_proxy=http://proxy.ua.cypress.com:8080
    - python3 --version
    - virtualenv venv
    - source venv/bin/activate
    - python3 -m pip install pyserial
    - python3 -m pip install --upgrade --force-reinstall git+http://git-ore.aus.cypress.com/repo/cysecuretools.git@${CY_SECURETOOLS_BRANCH}
    - python3 -m pip install --upgrade --force-reinstall git+http://git-ore.aus.cypress.com/repo/pyocd.git@${PYOCD_BRANCH}
    - pwd
    - rm -rf ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xxa/prebuilt/CyBootloader_Release
    - rm ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xxa/prebuilt/CyBootloader_WithLogs/CypressBootloader_CM0p.jwt
    - rm ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xxa/prebuilt/CyBootloader_WithLogs/CypressBootloader_CM0p.hex
    - cp -r ./develop/PSOC_064_2M/CypressBootloader/Debug/*.hex ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xxa/prebuilt/CyBootloader_WithLogs/
    - cp -r ./develop/PSOC_064_2M/CypressBootloader/Debug/*.jwt ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xxa/prebuilt/CyBootloader_WithLogs/

    - echo "[INFO] Start tests"


    - '[ -d tests ] && echo "[INFO] Directory tests exists." || echo "[INFO] Directory tests does not exists." && git clone http://git-ore.aus.cypress.com/repo/cy_mcuboot_project/cy_mcuboot.git tests && cd tests && git checkout tests_kosx_es100 && git branch && cd .. '
    - cd tests
    - mbedls -j > mbedls_data.json
    - pwd
    - echo "[INFO] Test provisioning using single stage policy (CM4), CyBootloader WithLogs"
    - python3 -m unittest test_provisioning.TestProvisioning.test_provision_2M_release_single_image
    - cd ..
    - rm -rf tests



    - '[ -d tests ] && echo "[INFO] Directory tests exists." || echo "[INFO] Directory tests does not exists." && git clone http://git-ore.aus.cypress.com/repo/cy_mcuboot_project/cy_mcuboot.git tests && cd tests && git checkout tests_kosx_es100 && git branch && cd .. '
    - cd tests
    - mbedls -j > mbedls_data.json
    - pwd
    - echo "[INFO] Test provisioning multi image, CyBootloader WithLogs"
    - python3 -m unittest test_provisioning.TestProvisioning.test_provision_2M_release_multi_image
    - cd ..
    - rm -rf tests



    - deactivate

  artifacts:
    expire_in: 4 weeks
    paths:
      - deploy




.mac_test_2M_smif_Release:
  stage: tests
  variables:
    GIT_SUBMODULE_STRATEGY: none
  tags:
    - MBED_TEST_MAC1014
  needs:
    - mac_2M_Bootloader
    - mac_2M_Multi_BlinkyApp_smif
    - mac_2M_SecureBlinkyApp_smif
    - mac_2M_BlinkyApp_smif
  only:
    variables:
      - $SCHEDULE == "true"
  script:
    - export https_proxy=http://proxy.ua.cypress.com:8080
    - python3 --version
    - virtualenv venv
    - source venv/bin/activate
    - python3 -m pip install pyserial
    - python3 -m pip install --upgrade --force-reinstall git+http://git-ore.aus.cypress.com/repo/cysecuretools.git@${CY_SECURETOOLS_BRANCH}
    - python3 -m pip install --upgrade --force-reinstall git+http://git-ore.aus.cypress.com/repo/pyocd.git@${PYOCD_BRANCH}
    - pwd
    - rm -rf ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xxa/prebuilt/CyBootloader_Release
    - rm ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xxa/prebuilt/CyBootloader_WithLogs/CypressBootloader_CM0p.jwt
    - rm ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xxa/prebuilt/CyBootloader_WithLogs/CypressBootloader_CM0p.hex
    - cp -r ./develop/PSOC_064_2M/CypressBootloader/Release/*.hex ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xxa/prebuilt/CyBootloader_WithLogs/
    - cp -r ./develop/PSOC_064_2M/CypressBootloader/Release/*.jwt ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xxa/prebuilt/CyBootloader_WithLogs/

    - echo "[INFO] Start tests"


    - echo "[INFO] Start tests"
    - '[ -d tests ] && echo "[INFO] Directory tests exists." || echo "[INFO] Directory tests does not exists." && git clone http://git-ore.aus.cypress.com/repo/cy_mcuboot_project/cy_mcuboot.git tests && cd tests && git checkout tests_kosx_es100 && git branch && cd .. '
    - cd tests
    - mbedls -j > mbedls_data.json
    - pwd
    - echo "[INFO] Test provisioning using single stage policy (CM4), CyBootloader WithLogs"
    - python3 -m unittest test_provisioning.TestProvisioning.test_provision_2M_release_single_image_smif
    - cd ..
    - rm -rf tests



    - '[ -d tests ] && echo "[INFO] Directory tests exists." || echo "[INFO] Directory tests does not exists." && git clone http://git-ore.aus.cypress.com/repo/cy_mcuboot_project/cy_mcuboot.git tests && cd tests && git checkout tests_kosx_es100 && git branch && cd .. '
    - cd tests
    - mbedls -j > mbedls_data.json
    - pwd
    - echo "[INFO] Test provisioning using single stage policy (CM4), CyBootloader WithLogs"
    - python3 -m unittest test_provisioning.TestProvisioning.test_provision_2M_release_multi_image_smif
    - cd ..
    - rm -rf tests


    - deactivate

  artifacts:
    expire_in: 4 weeks
    paths:
      - deploy



.mac_test_2M_smif_Debug:
  stage: tests
  variables:
    GIT_SUBMODULE_STRATEGY: none
  tags:
    - MBED_TEST_MAC1014
  needs:
    - mac_2M_Bootloader
    - mac_2M_Multi_BlinkyApp_smif
    - mac_2M_SecureBlinkyApp_smif
    - mac_2M_BlinkyApp_smif
  script:
    - export https_proxy=http://proxy.ua.cypress.com:8080
    - python3 --version
    - virtualenv venv
    - source venv/bin/activate
    - python3 -m pip install pyserial
    - python3 -m pip install --upgrade --force-reinstall git+http://git-ore.aus.cypress.com/repo/cysecuretools.git@${CY_SECURETOOLS_BRANCH}
    - python3 -m pip install --upgrade --force-reinstall git+http://git-ore.aus.cypress.com/repo/pyocd.git@${PYOCD_BRANCH}
    - pwd
    - rm -rf ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xxa/prebuilt/CyBootloader_Release
    - rm ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xxa/prebuilt/CyBootloader_WithLogs/CypressBootloader_CM0p.jwt
    - rm ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xxa/prebuilt/CyBootloader_WithLogs/CypressBootloader_CM0p.hex
    - cp -r ./develop/PSOC_064_2M/CypressBootloader/Debug/*.hex ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xxa/prebuilt/CyBootloader_WithLogs/
    - cp -r ./develop/PSOC_064_2M/CypressBootloader/Debug/*.jwt ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xxa/prebuilt/CyBootloader_WithLogs/

    - echo "[INFO] Start tests"


    - echo "[INFO] Start tests"
    - '[ -d tests ] && echo "[INFO] Directory tests exists." || echo "[INFO] Directory tests does not exists." && git clone http://git-ore.aus.cypress.com/repo/cy_mcuboot_project/cy_mcuboot.git tests && cd tests && git checkout tests_kosx_es100 && git branch && cd .. '
    - cd tests
    - mbedls -j > mbedls_data.json
    - pwd
    - echo "[INFO] Test provisioning using single stage policy (CM4), CyBootloader WithLogs"
    - python3 -m unittest test_provisioning.TestProvisioning.test_provision_2M_release_single_image_smif
    - cd ..
    - rm -rf tests



    - '[ -d tests ] && echo "[INFO] Directory tests exists." || echo "[INFO] Directory tests does not exists." && git clone http://git-ore.aus.cypress.com/repo/cy_mcuboot_project/cy_mcuboot.git tests && cd tests && git checkout tests_kosx_es100 && git branch && cd .. '
    - cd tests
    - mbedls -j > mbedls_data.json
    - pwd
    - echo "[INFO] Test provisioning using single stage policy (CM4), CyBootloader WithLogs"
    - python3 -m unittest test_provisioning.TestProvisioning.test_provision_2M_release_multi_image_smif
    - cd ..
    - rm -rf tests


    - deactivate

  artifacts:
    expire_in: 4 weeks
    paths:
      - deploy



#######################################################################################################################################################
##################------------------------------------------------- TESTS 1M ---------------------------------------------#############################
#######################################################################################################################################################

mac_test_1M_Release:
  stage: tests
  variables:
    GIT_SUBMODULE_STRATEGY: none
  tags:
    - MBED_TEST_MAC1014
  needs:
    - mac_1M_Bootloader
    - mac_1M_Multi_BlinkyApp
    - mac_1M_SecureBlinkyApp
    - mac_1M_BlinkyApp
  only:
    variables:
      - $SCHEDULE == "true"
  script:
    - export https_proxy=http://proxy.ua.cypress.com:8080
    - python3 --version
    - virtualenv venv
    - source venv/bin/activate
    - python3 -m pip install pyserial
    - python3 -m pip install --upgrade --force-reinstall git+http://git-ore.aus.cypress.com/repo/cysecuretools.git@${CY_SECURETOOLS_BRANCH}
    - python3 -m pip install --upgrade --force-reinstall git+http://git-ore.aus.cypress.com/repo/pyocd.git@${PYOCD_BRANCH}
    - pwd
    - rm -rf ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx7/prebuilt/CyBootloader_Release
    - rm ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx7/prebuilt/CyBootloader_WithLogs/CypressBootloader_CM0p.jwt
    - rm ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx7/prebuilt/CyBootloader_WithLogs/CypressBootloader_CM0p.hex
    - cp -r ./develop/PSOC_064_1M/CypressBootloader/Release/*.hex ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx7/prebuilt/CyBootloader_WithLogs/
    - cp -r ./develop/PSOC_064_1M/CypressBootloader/Release/*.jwt ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx7/prebuilt/CyBootloader_WithLogs/

    - echo "[INFO] Start tests"


    - '[ -d tests ] && echo "[INFO] Directory tests exists." || echo "[INFO] Directory tests does not exists." && git clone http://git-ore.aus.cypress.com/repo/cy_mcuboot_project/cy_mcuboot.git tests && cd tests && git checkout tests_kosx_es100 && git branch && cd .. '
    - cd tests
    - mbedls -j > mbedls_data.json
    - pwd
    - echo "[INFO] Test provisioning using single stage policy (CM4), CyBootloader WithLogs"
    - python3 -m unittest test_provisioning.TestProvisioning.test_provision_1M_release_single_image
    - cd ..
    - rm -rf tests



    - '[ -d tests ] && echo "[INFO] Directory tests exists." || echo "[INFO] Directory tests does not exists." && git clone http://git-ore.aus.cypress.com/repo/cy_mcuboot_project/cy_mcuboot.git tests && cd tests && git checkout tests_kosx_es100 && git branch && cd .. '
    - cd tests
    - mbedls -j > mbedls_data.json
    - pwd
    - echo "[INFO] Test provisioning multi image, CyBootloader WithLogs"
    - python3 -m unittest test_provisioning.TestProvisioning.test_provision_1M_release_multi_image
    - cd ..
    - rm -rf tests



    - deactivate

  artifacts:
    expire_in: 4 weeks
    paths:
      - deploy



mac_test_1M_Debug:
  stage: tests
  variables:
    GIT_SUBMODULE_STRATEGY: none
  tags:
    - MBED_TEST_MAC1014
  needs:
    - mac_1M_Bootloader
    - mac_1M_Multi_BlinkyApp
    - mac_1M_SecureBlinkyApp
    - mac_1M_BlinkyApp
  script:
    - export https_proxy=http://proxy.ua.cypress.com:8080
    - python3 --version
    - virtualenv venv
    - source venv/bin/activate
    - python3 -m pip install pyserial
    - python3 -m pip install --upgrade --force-reinstall git+http://git-ore.aus.cypress.com/repo/cysecuretools.git@${CY_SECURETOOLS_BRANCH}
    - python3 -m pip install --upgrade --force-reinstall git+http://git-ore.aus.cypress.com/repo/pyocd.git@${PYOCD_BRANCH}
    - pwd
    - rm -rf ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx7/prebuilt/CyBootloader_Release
    - rm ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx7/prebuilt/CyBootloader_WithLogs/CypressBootloader_CM0p.jwt
    - rm ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx7/prebuilt/CyBootloader_WithLogs/CypressBootloader_CM0p.hex
    - cp -r ./develop/PSOC_064_1M/CypressBootloader/Debug/*.hex ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx7/prebuilt/CyBootloader_WithLogs/
    - cp -r ./develop/PSOC_064_1M/CypressBootloader/Debug/*.jwt ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx7/prebuilt/CyBootloader_WithLogs/

    - echo "[INFO] Start tests"


    - '[ -d tests ] && echo "[INFO] Directory tests exists." || echo "[INFO] Directory tests does not exists." && git clone http://git-ore.aus.cypress.com/repo/cy_mcuboot_project/cy_mcuboot.git tests && cd tests && git checkout tests_kosx_es100 && git branch && cd .. '
    - cd tests
    - mbedls -j > mbedls_data.json
    - pwd
    - echo "[INFO] Test provisioning using single stage policy (CM4), CyBootloader WithLogs"
    - python3 -m unittest test_provisioning.TestProvisioning.test_provision_1M_release_single_image
    - cd ..
    - rm -rf tests



    - '[ -d tests ] && echo "[INFO] Directory tests exists." || echo "[INFO] Directory tests does not exists." && git clone http://git-ore.aus.cypress.com/repo/cy_mcuboot_project/cy_mcuboot.git tests && cd tests && git checkout tests_kosx_es100 && git branch && cd .. '
    - cd tests
    - mbedls -j > mbedls_data.json
    - pwd
    - echo "[INFO] Test provisioning multi image, CyBootloader WithLogs"
    - python3 -m unittest test_provisioning.TestProvisioning.test_provision_1M_release_multi_image
    - cd ..
    - rm -rf tests



    - deactivate

  artifacts:
    expire_in: 4 weeks
    paths:
      - deploy




.mac_test_1M_smif_Release:
  stage: tests
  variables:
    GIT_SUBMODULE_STRATEGY: none
  tags:
    - MBED_TEST_MAC1014
  needs:
    - mac_1M_Bootloader
    - mac_1M_Multi_BlinkyApp_smif
    - mac_1M_SecureBlinkyApp_smif
    - mac_1M_BlinkyApp_smif
  only:
    variables:
      - $SCHEDULE == "true"
  script:
    - export https_proxy=http://proxy.ua.cypress.com:8080
    - python3 --version
    - virtualenv venv
    - source venv/bin/activate
    - python3 -m pip install pyserial
    - python3 -m pip install --upgrade --force-reinstall git+http://git-ore.aus.cypress.com/repo/cysecuretools.git@${CY_SECURETOOLS_BRANCH}
    - python3 -m pip install --upgrade --force-reinstall git+http://git-ore.aus.cypress.com/repo/pyocd.git@${PYOCD_BRANCH}
    - pwd
    - rm -rf ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx7/prebuilt/CyBootloader_Release
    - rm ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx7/prebuilt/CyBootloader_WithLogs/CypressBootloader_CM0p.jwt
    - rm ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx7/prebuilt/CyBootloader_WithLogs/CypressBootloader_CM0p.hex
    - cp -r ./develop/PSOC_064_1M/CypressBootloader/Release/*.hex ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx7/prebuilt/CyBootloader_WithLogs/
    - cp -r ./develop/PSOC_064_1M/CypressBootloader/Release/*.jwt ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx7/prebuilt/CyBootloader_WithLogs/

    - echo "[INFO] Start tests"


    - echo "[INFO] Start tests"
    - '[ -d tests ] && echo "[INFO] Directory tests exists." || echo "[INFO] Directory tests does not exists." && git clone http://git-ore.aus.cypress.com/repo/cy_mcuboot_project/cy_mcuboot.git tests && cd tests && git checkout tests_kosx_es100 && git branch && cd .. '
    - cd tests
    - mbedls -j > mbedls_data.json
    - pwd
    - echo "[INFO] Test provisioning using single stage policy (CM4), CyBootloader WithLogs"
    - python3 -m unittest test_provisioning.TestProvisioning.test_provision_1M_release_single_image_smif
    - cd ..
    - rm -rf tests



    - '[ -d tests ] && echo "[INFO] Directory tests exists." || echo "[INFO] Directory tests does not exists." && git clone http://git-ore.aus.cypress.com/repo/cy_mcuboot_project/cy_mcuboot.git tests && cd tests && git checkout tests_kosx_es100 && git branch && cd .. '
    - cd tests
    - mbedls -j > mbedls_data.json
    - pwd
    - echo "[INFO] Test provisioning using single stage policy (CM4), CyBootloader WithLogs"
    - python3 -m unittest test_provisioning.TestProvisioning.test_provision_1M_release_multi_image_smif
    - cd ..
    - rm -rf tests


    - deactivate

  artifacts:
    expire_in: 4 weeks
    paths:
      - deploy



.mac_test_1M_smif_Debug:
  stage: tests
  variables:
    GIT_SUBMODULE_STRATEGY: none
  tags:
    - MBED_TEST_MAC1014
  needs:
    - mac_1M_Bootloader
    - mac_1M_Multi_BlinkyApp_smif
    - mac_1M_SecureBlinkyApp_smif
    - mac_1M_BlinkyApp_smif
  script:
    - export https_proxy=http://proxy.ua.cypress.com:8080
    - python3 --version
    - virtualenv venv
    - source venv/bin/activate
    - python3 -m pip install pyserial
    - python3 -m pip install --upgrade --force-reinstall git+http://git-ore.aus.cypress.com/repo/cysecuretools.git@${CY_SECURETOOLS_BRANCH}
    - python3 -m pip install --upgrade --force-reinstall git+http://git-ore.aus.cypress.com/repo/pyocd.git@${PYOCD_BRANCH}
    - pwd
    - rm -rf ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx7/prebuilt/CyBootloader_Release
    - rm ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx7/prebuilt/CyBootloader_WithLogs/CypressBootloader_CM0p.jwt
    - rm ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx7/prebuilt/CyBootloader_WithLogs/CypressBootloader_CM0p.hex
    - cp -r ./develop/PSOC_064_1M/CypressBootloader/Debug/*.hex ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx7/prebuilt/CyBootloader_WithLogs/
    - cp -r ./develop/PSOC_064_1M/CypressBootloader/Debug/*.jwt ./venv/lib/python3.7/site-packages/cysecuretools/targets/cyb06xx7/prebuilt/CyBootloader_WithLogs/

    - echo "[INFO] Start tests"


    - echo "[INFO] Start tests"
    - '[ -d tests ] && echo "[INFO] Directory tests exists." || echo "[INFO] Directory tests does not exists." && git clone http://git-ore.aus.cypress.com/repo/cy_mcuboot_project/cy_mcuboot.git tests && cd tests && git checkout tests_kosx_es100 && git branch && cd .. '
    - cd tests
    - mbedls -j > mbedls_data.json
    - pwd
    - echo "[INFO] Test provisioning using single stage policy (CM4), CyBootloader WithLogs"
    - python3 -m unittest test_provisioning.TestProvisioning.test_provision_1M_release_single_image_smif
    - cd ..
    - rm -rf tests



    - '[ -d tests ] && echo "[INFO] Directory tests exists." || echo "[INFO] Directory tests does not exists." && git clone http://git-ore.aus.cypress.com/repo/cy_mcuboot_project/cy_mcuboot.git tests && cd tests && git checkout tests_kosx_es100 && git branch && cd .. '
    - cd tests
    - mbedls -j > mbedls_data.json
    - pwd
    - echo "[INFO] Test provisioning using single stage policy (CM4), CyBootloader WithLogs"
    - python3 -m unittest test_provisioning.TestProvisioning.test_provision_1M_release_multi_image_smif
    - cd ..
    - rm -rf tests


    - deactivate

  artifacts:
    expire_in: 4 weeks
    paths:
      - deploy




#static code analyzer with Cppcheck tool
win_cpp_check:
  stage: cppcheck
  needs: []
  tags:
    - MBED_TEST
  script:
    - cd boot/cypress
    - make run_cppcheck PLATFORM=PSOC_064_2M APP_NAME=CypressBootloader CPP_CHECK_SCOPE=all
    - make run_cppcheck PLATFORM=PSOC_064_1M APP_NAME=CypressBootloader CPP_CHECK_SCOPE=all
    - make run_cppcheck PLATFORM=PSOC_064_512K APP_NAME=CypressBootloader CPP_CHECK_SCOPE=all
    - cd ../../



.MCUboot_simulator:
  stage: sim
  tags:
    - FW_SECURITY_TEST_UBUNTU1804
  cache: {}
  script:
    - export https_proxy=http://proxy.ua.cypress.com:8080
    - python3 --version
    - pwd
    - git submodule deinit --all -f
    - git submodule update --init --recursive
    - cd sim
    - cargo test --verbose



##############################################################################
# Upload build artifacts to http://iot-webserver.aus.cypress.com/projects/iot_release/ASSETS/repo/mcuboot/
deploy_asset:
  stage: deploy
  variables:
    GIT_STRATEGY: none
    GIT_SUBMODULE_STRATEGY: none
  tags:
    - devops-assets
  only:
    - /^develop$/
    - /^cypress$/
    - /^integration/cy_bootloader$/
  only:
    variables:
      - $SCHEDULE == "true"
  script:
    - zip -rX deploy/cy_bootloader_artifacts_${CY_BOOTLOADER_MAJOR}.${CY_BOOTLOADER_MINOR}.${CY_BOOTLOADER_REV}.${CY_BOOTLOADER_BUILD}.zip deploy
    - git clone git@git-ore.aus.cypress.com:devops/devops_scripts.git
    - bash devops_scripts/job_deploy_to_assets.sh
